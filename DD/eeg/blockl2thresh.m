function X=blockl2thresh(Xt,penco,KU,KG,varargin)%% X=blockl2thresh(Xt,penco,KU,KG)%% Solves min norm(X-Xt)^2+penco*STSBLOCKL2(x).% STSBLOCKL2(x) is the two norm of each block of X times the root of the% number of bases in that block.  Blocks are specified by KU and KG; i.e.% KU=[7 3 2 ...]' KG=[3 4 2 ...]' means X(1:7,1:3) are in one block,% x(8:10,1:3) are in another block, x(1:7,4:7) are in yet another block, etc.%% Modified 3/4/08 to use root of number of bases.  Mod. 3/26/08 to make% this optional.useNbpen=1;if narargin>4    useNbpen=varargin{1}.useNbpen;end%penco=penco/2;X=zeros(size(Xt));%t=size(Xt,2);curU=1;for cu=1:length(KU)    curG=1;    for cg=1:length(KG)        xt=Xt(curU:curU+KU(cu)-1,curG:curG+KG(cg)-1);                nz=norm(xt,'fro');                wt=1;        if useNbpen            wt=sqrt(KU(c)*KG(d));        end                if 2*nz > penco*sqrt(KU(cu)*KG(cg))            X(curU:curU+KU(cu)-1,curG:curG+KG(cg)-1)=...                (1-penco*wt/(2*nz))*Xt(curU:curU+KU(cu)-1,curG:curG+KG(cg)-1);        end                curG=curG+KG(cg);    end    curU=curU+KU(cu);end